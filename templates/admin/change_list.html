{% extends "admin/base_site.html" %}
{% load i18n admin_urls static admin_list %}

{% block title %}{{ title }} | {{ site_title|default:_('Django site admin') }}{% endblock %}

{% block extrahead %}
    {{ block.super }}
    <script src="{% static 'admin/js/filters.js' %}"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
{% endblock %}

{% block breadcrumbs %}
<nav class="card px-6 py-3 mb-6" aria-label="Breadcrumb">
    <ol class="flex items-center space-x-2 text-sm" style="color: var(--text-secondary);">
        <li>
            <a href="{% url 'admin:index' %}" class="text-emerald-600 hover:text-emerald-700 font-medium transition-colors">
                <i class="fas fa-home mr-1"></i>{% trans 'Home' %}
            </a>
        </li>
        <li>
            <i class="fas fa-chevron-right mx-2" style="color: var(--text-muted);"></i>
            <a href="{% url 'admin:app_list' app_label=opts.app_label %}" class="text-emerald-600 hover:text-emerald-700 font-medium transition-colors">
                {{ opts.app_config.verbose_name }}
            </a>
        </li>
        <li>
            <i class="fas fa-chevron-right mx-2" style="color: var(--text-muted);"></i>
            <span class="font-semibold" style="color: var(--text-primary);">{{ opts.verbose_name_plural|capfirst }}</span>
        </li>
    </ol>
</nav>
{% endblock %}

{% block content %}
<div class="admin-content">
    <!-- Header Section -->
    <div class="admin-header bg-gradient-to-r from-emerald-600 to-emerald-700 text-white p-6 rounded-lg mb-6">
        <div class="flex items-center justify-between">
            <div>
                <h1 class="text-3xl font-bold flex items-center">
                    {% if 'user' in opts.model_name %}
                        <i class="fas fa-users mr-3"></i>
                    {% elif 'product' in opts.model_name %}
                        <i class="fas fa-boxes mr-3"></i>
                    {% elif 'order' in opts.model_name %}
                        <i class="fas fa-shopping-cart mr-3"></i>
                    {% elif 'category' in opts.model_name %}
                        <i class="fas fa-tags mr-3"></i>
                    {% elif 'address' in opts.model_name %}
                        <i class="fas fa-map-marker-alt mr-3"></i>
                    {% elif 'checkout' in opts.model_name %}
                        <i class="fas fa-credit-card mr-3"></i>
                    {% else %}
                        <i class="fas fa-list mr-3"></i>
                    {% endif %}
                    {{ opts.verbose_name_plural|capfirst }}
                </h1>
                <p class="text-emerald-100 mt-1">
                    {% if cl.result_count %}
                        {% blocktrans count counter=cl.result_count %}{{ counter }} {{ opts.verbose_name }}{% plural %}{{ counter }} {{ opts.verbose_name_plural }}{% endblocktrans %}
                    {% else %}
                        {% trans 'No' %} {{ opts.verbose_name_plural }}
                    {% endif %}
                </p>
            </div>
            
            {% if has_add_permission %}
            <a href="{% url 'admin:'|add:opts.app_label|add:'_'|add:opts.model_name|add:'_add' %}"
               class="bg-white text-emerald-700 hover:bg-emerald-50 px-6 py-3 rounded-lg font-semibold transition-all duration-200 flex items-center space-x-2">
                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6"/>
                </svg>
                <span>Add {{ opts.verbose_name }}</span>
            </a>
            {% endif %}
        </div>
    </div>

    <!-- Search and Filters Section -->
    <div class="card mb-6">
        <div class="px-6 py-4 border-b" style="background-color: var(--bg-secondary); border-color: var(--border-color);">
            <h3 class="text-lg font-semibold flex items-center" style="color: var(--text-primary);">
                <i class="fas fa-search mr-2 text-emerald-600"></i>
                Search & Filters
            </h3>
        </div>
        
        <div class="p-6">
            <!-- Search Bar -->
            {% if cl.search_fields %}
            <div class="mb-6">
                <form method="get" id="changelist-search">
                    <div class="flex gap-4 items-end">
                        <div class="flex-1">
                            <label for="searchbar" class="block text-sm font-medium mb-2" style="color: var(--text-primary);">Search {{ opts.verbose_name_plural }}</label>
                            <div class="relative">
                                <input type="search" id="searchbar" name="{{ search_var }}" value="{{ cl.query }}"
                                       class="w-full pl-10 pr-4 py-3 border rounded-lg focus:ring-2 focus:ring-emerald-500 focus:border-emerald-500 transition-colors"
                                       style="border-color: var(--border-color); background-color: var(--bg-card); color: var(--text-primary);"
                                       placeholder="Search products...">
                                <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                                    <i class="fas fa-search" style="color: var(--text-muted);"></i>
                                </div>
                            </div>
                        </div>
                        <button type="submit" class="px-6 py-3 bg-emerald-600 text-white rounded-lg hover:bg-emerald-700 transition-colors font-medium">
                            <i class="fas fa-search mr-2"></i>Search
                        </button>
                        {% if cl.query %}
                        <a href="?" class="px-4 py-3 text-white rounded-lg transition-colors"
                           style="background-color: var(--text-muted);"
                           onmouseover="this.style.backgroundColor='var(--text-secondary)';"
                           onmouseout="this.style.backgroundColor='var(--text-muted)';">
                            <i class="fas fa-times mr-1"></i>Clear
                        </a>
                        {% endif %}
                    </div>
                    {% for k, v in cl.params.items %}
                        {% if k != search_var %}
                            <input type="hidden" name="{{ k }}" value="{{ v }}">
                        {% endif %}
                    {% endfor %}
                </form>
            </div>
            {% endif %}
            
            <!-- Filters -->
            {% if cl.has_filters %}
            <div class="border-t pt-6" style="border-color: var(--border-color);">
                <div class="flex items-center justify-between mb-4">
                    <h4 class="text-lg font-semibold flex items-center" style="color: var(--text-primary);">
                        <i class="fas fa-filter mr-2 text-emerald-600"></i>
                        Filters
                    </h4>
                    {% if cl.has_active_filters %}
                    <a href="?" class="text-emerald-600 hover:text-emerald-700 text-sm font-medium transition-colors duration-150">
                        <i class="fas fa-times mr-1"></i>Clear all filters
                    </a>
                    {% endif %}
                </div>
                
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6">
                    {% for spec in cl.filter_specs %}
                    <div class="filter-group">
                        <div class="rounded-lg p-4" style="background-color: var(--bg-secondary);">
                            <h5 class="text-sm font-semibold mb-3 flex items-center" style="color: var(--text-primary);">
                                <span class="w-2 h-2 bg-emerald-500 rounded-full mr-2"></span>
                                {{ spec.title }}
                            </h5>
                            <div class="space-y-2">
                                {% for choice in spec.choices %}
                                <div class="filter-option">
                                    {% if choice.selected %}
                                    <a href="{{ choice.query_string|iriencode }}"
                                       class="flex items-center justify-between w-full px-3 py-2 text-sm bg-emerald-100 text-emerald-800 rounded-lg font-medium transition-all duration-150">
                                        <span class="flex items-center">
                                            <i class="fas fa-check text-emerald-600 mr-2"></i>
                                        {{ choice.display }}
                                    </span>
                                    <i class="fas fa-times text-emerald-600 hover:text-emerald-800"></i>
                                </a>
                                {% else %}
                                <a href="{{ choice.query_string|iriencode }}"
                                   class="flex items-center w-full px-3 py-2.5 text-sm rounded-lg transition-all duration-150 border border-transparent hover:border-emerald-200"
                                   style="color: var(--text-secondary); background-color: var(--bg-card);"
                                   onmouseover="this.style.backgroundColor='#f0fdf4'; this.style.color='#047857';"
                                   onmouseout="this.style.backgroundColor='var(--bg-card)'; this.style.color='var(--text-secondary)';">
                                    <i class="fas fa-circle mr-2 text-xs" style="color: var(--text-muted);"></i>
                                    <span>{{ choice.display }}</span>
                                </a>
                                {% endif %}
                            </div>
                            {% endfor %}
                        </div>
                    </div>
                </div>
                {% endfor %}
            </div>
        </div>
        {% endif %}
    </div>

    <!-- Main Content Area -->
    <div class="w-full">
        <!-- Actions Bar -->
        <div class="card mb-6">
            <div class="p-6">
            <div class="flex flex-col lg:flex-row lg:items-center lg:justify-between space-y-4 lg:space-y-0">
                <!-- Page Info -->
                <div class="flex items-center space-x-4">
                    <h3 class="text-lg font-semibold" style="color: var(--text-primary);">
                        {% if cl.result_count %}
                            {{ cl.result_count }} {{ opts.verbose_name_plural|lower }}
                        {% else %}
                            No {{ opts.verbose_name_plural|lower }}
                        {% endif %}
                    </h3>
                </div>

                <!-- Actions -->
                {% if action_form and actions_on_top and cl.show_admin_actions %}
                <div class="flex items-center space-x-4">
                        <form method="post" class="flex items-center space-x-3">
                            {% csrf_token %}
                            <select name="action"
                                    class="border-2 rounded-lg px-4 py-2 text-sm focus:ring-2 focus:ring-emerald-500 focus:border-emerald-500 transition-all duration-200"
                                    style="border-color: var(--border-color); background-color: var(--bg-card); color: var(--text-primary);">
                                <option value="">Select action...</option>
                                {% for choice in action_form.action.field.choices %}
                                    <option value="{{ choice.0 }}">{{ choice.1|capfirst }}</option>
                                {% endfor %}
                            </select>
                            <button type="submit"
                                    class="bg-emerald-600 hover:bg-emerald-700 text-white px-4 py-2 rounded-lg text-sm font-semibold transition-colors duration-200">
                                Go
                            </button>
                        </form>
                    </div>
                    {% endif %}
                </div>
            </div>
        </div>

            <!-- Results Table - Using Django's Built-in System -->
            <div class="card">
                {% if cl.result_count %}
                <div class="p-6 pb-0">
                    <div class="overflow-x-auto rounded-lg">
                    {% if action_form and actions_on_top and cl.show_admin_actions %}
                    <form method="post" class="changelist-results">
                        {% csrf_token %}
                        {% result_list cl %}
                    </form>
                    {% else %}
                    <div class="changelist-results">
                        {% result_list cl %}
                    </div>
                    {% endif %}
                    </div>
                </div>
                
                <!-- Pagination -->
                {% if cl.result_count %}
                <div class="px-6 py-4 border-t" style="background-color: var(--bg-secondary); border-color: var(--border-color);">
                    <div class="flex items-center justify-between">
                        <div class="flex-1 flex justify-between sm:hidden">
                            {% if cl.paginator.has_previous %}
                            <a href="?{% if cl.paginator.previous_page_number %}page={{ cl.paginator.previous_page_number }}{% endif %}{{ cl.get_query_string }}"
                               class="relative inline-flex items-center px-4 py-2 border text-sm font-medium rounded-md transition-colors duration-150"
                               style="border-color: var(--border-color); background-color: var(--bg-card); color: var(--text-secondary);"
                               onmouseover="this.style.backgroundColor='var(--bg-secondary)';"
                               onmouseout="this.style.backgroundColor='var(--bg-card)';">
                                Previous
                            </a>
                            {% endif %}
                            {% if cl.paginator.has_next %}
                            <a href="?page={{ cl.paginator.next_page_number }}{{ cl.get_query_string }}"
                               class="ml-3 relative inline-flex items-center px-4 py-2 border text-sm font-medium rounded-md transition-colors duration-150"
                               style="border-color: var(--border-color); background-color: var(--bg-card); color: var(--text-secondary);"
                               onmouseover="this.style.backgroundColor='var(--bg-secondary)';"
                               onmouseout="this.style.backgroundColor='var(--bg-card)';">
                                Next
                            </a>
                            {% endif %}
                        </div>
                        <div class="hidden sm:flex-1 sm:flex sm:items-center sm:justify-between">
                            <div>
                                <p class="text-sm" style="color: var(--text-secondary);">
                                    Showing
                                    <span class="font-semibold">{{ cl.paginator.start_index }}</span>
                                    to
                                    <span class="font-semibold">{{ cl.paginator.end_index }}</span>
                                    of
                                    <span class="font-semibold">{{ cl.result_count }}</span>
                                    results
                                </p>
                            </div>
                            <div>
                                <nav class="relative z-0 inline-flex rounded-lg -space-x-px">
                                    {% if cl.paginator.has_previous %}
                                    <a href="?{% if cl.paginator.previous_page_number %}page={{ cl.paginator.previous_page_number }}{% endif %}{{ cl.get_query_string }}"
                                       class="relative inline-flex items-center px-3 py-2 rounded-l-lg border text-sm font-medium transition-colors duration-150"
                                       style="border-color: var(--border-color); background-color: var(--bg-card); color: var(--text-secondary);"
                                       onmouseover="this.style.backgroundColor='var(--bg-secondary)';"
                                       onmouseout="this.style.backgroundColor='var(--bg-card)';">
                                        <i class="fas fa-chevron-left"></i>
                                    </a>
                                    {% endif %}
                                    
                                    <span class="relative inline-flex items-center px-4 py-2 border text-sm font-medium"
                                          style="border-color: var(--border-color); background-color: var(--bg-card); color: var(--text-primary);">
                                        {{ cl.paginator.number }} of {{ cl.paginator.paginator.num_pages }}
                                    </span>
                                    
                                    {% if cl.paginator.has_next %}
                                    <a href="?page={{ cl.paginator.next_page_number }}{{ cl.get_query_string }}"
                                       class="relative inline-flex items-center px-3 py-2 rounded-r-lg border text-sm font-medium transition-colors duration-150"
                                       style="border-color: var(--border-color); background-color: var(--bg-card); color: var(--text-secondary);"
                                       onmouseover="this.style.backgroundColor='var(--bg-secondary)';"
                                       onmouseout="this.style.backgroundColor='var(--bg-card)';">
                                        <i class="fas fa-chevron-right"></i>
                                    </a>
                                    {% endif %}
                                </nav>
                            </div>
                        </div>
                    </div>
                </div>
                {% endif %}
                
                {% else %}
                <div class="text-center py-16">
                    <div class="inline-flex items-center justify-center w-16 h-16 rounded-full mb-4"
                         style="background-color: var(--bg-secondary);">
                        <svg class="w-8 h-8" fill="none" stroke="currentColor" viewBox="0 0 24 24" style="color: var(--text-muted);">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20 13V6a2 2 0 00-2-2H6a2 2 0 00-2 2v7m16 0v5a2 2 0 01-2 2H6a2 2 0 01-2-2v-5m16 0h-2M4 13h2m0 0v5a2 2 0 002 2h8a2 2 0 002-2v-5"/>
                        </svg>
                    </div>
                    <h3 class="text-lg font-medium mb-2" style="color: var(--text-primary);">No {{ opts.verbose_name_plural|lower }}</h3>
                    <p class="mb-6" style="color: var(--text-muted);">Get started by creating a new {{ opts.verbose_name|lower }}.</p>
                    {% if has_add_permission %}
                    <a href="{% url 'admin:'|add:opts.app_label|add:'_'|add:opts.model_name|add:'_add' %}"
                       class="inline-flex items-center px-6 py-3 border border-transparent text-base font-medium rounded-lg text-white bg-emerald-600 hover:bg-emerald-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-emerald-500 transition-colors duration-200">
                        <svg class="-ml-1 mr-2 h-5 w-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6"/>
                        </svg>
                        Add {{ opts.verbose_name }}
                    </a>
                    {% endif %}
                </div>
                {% endif %}
            </div>
        </div>
    </div>
</div>

<!-- Enhanced CSS for Django Admin Tables -->
<style>
/* Override Django's default table styling */
.changelist-results table {
    width: 100%;
    border-collapse: collapse;
    margin: 0;
    background-color: #ffffff;
}

.changelist-results thead th {
    background: linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%) !important;
    padding: 16px;
    text-align: left;
    font-weight: 600;
    color: #374151 !important;
    text-transform: uppercase;
    font-size: 0.75rem;
    letter-spacing: 0.05em;
    border-bottom: 2px solid #e5e7eb;
    position: sticky;
    top: 0;
    z-index: 10;
}

/* Ensure first column header is always left-aligned */
.changelist-results thead th:first-child {
    text-align: left !important;
}

.changelist-results tbody td {
    padding: 12px 16px;
    border-bottom: 1px solid #f3f4f6;
    vertical-align: middle;
    color: #374151 !important;
    font-size: 0.875rem;
    background-color: #ffffff !important;
}

/* Ensure first column content is always left-aligned */
.changelist-results tbody td:first-child {
    text-align: left !important;
    font-weight: 500;
}

.changelist-results tbody tr {
    background-color: #ffffff !important;
}

.changelist-results tbody tr:hover {
    background-color: #f0f9ff !important;
    transition: background-color 0.15s ease;
}

.changelist-results tbody tr:hover td {
    background-color: #f0f9ff !important;
}

.changelist-results tbody td a {
    color: #2563eb !important;
    text-decoration: none;
    font-weight: 500;
    transition: color 0.15s ease;
}

.changelist-results tbody td a:hover {
    color: #1d4ed8 !important;
    text-decoration: underline;
}

/* Checkbox styling */
.changelist-results .action-checkbox-column {
    width: 40px;
    text-align: center !important;
    background-color: #ffffff !important;
}

.changelist-results .action-checkbox {
    width: 16px;
    height: 16px;
    border-radius: 4px;
    border: 2px solid #d1d5db;
    accent-color: #059669;
}

.changelist-results .action-checkbox:checked {
    background-color: #059669;
    border-color: #059669;
}

/* Override any dark theme styles that might interfere */
.changelist-results,
.changelist-results table,
.changelist-results thead,
.changelist-results tbody,
.changelist-results tr,
.changelist-results th,
.changelist-results td {
    background-color: #ffffff !important;
}

.changelist-results thead th {
    background: linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%) !important;
    color: #374151 !important;
}

.changelist-results tbody tr:hover,
.changelist-results tbody tr:hover td,
.changelist-results tbody tr:hover th {
    background-color: #f0f9ff !important;
}

/* Dark theme styles - only apply when explicitly in dark mode */
@media (prefers-color-scheme: dark) {
    html[data-theme="dark"] .changelist-results,
    html[data-theme="dark"] .changelist-results table,
    html[data-theme="dark"] .changelist-results thead,
    html[data-theme="dark"] .changelist-results tbody,
    html[data-theme="dark"] .changelist-results tr,
    html[data-theme="dark"] .changelist-results th,
    html[data-theme="dark"] .changelist-results td {
        background-color: #1f2937 !important;
    }

    html[data-theme="dark"] .changelist-results thead th {
        background: linear-gradient(135deg, #374151 0%, #1f2937 100%) !important;
        color: #d1d5db !important;
        border-bottom-color: #4b5563;
    }

    html[data-theme="dark"] .changelist-results tbody td {
        border-bottom-color: #4b5563;
        color: #d1d5db !important;
        background-color: #1f2937 !important;
    }

    html[data-theme="dark"] .changelist-results tbody tr:hover,
    html[data-theme="dark"] .changelist-results tbody tr:hover td {
        background-color: #1e3a8a !important;
    }

    html[data-theme="dark"] .changelist-results tbody td a {
        color: #60a5fa !important;
    }

    html[data-theme="dark"] .changelist-results tbody td a:hover {
        color: #93c5fd !important;
    }
}

/* Custom field styling for Products */
.product-price {
    font-weight: 600;
    color: #059669 !important;
}

.category-badge {
    display: inline-flex;
    align-items: center;
    padding: 4px 8px;
    border-radius: 9999px;
    font-size: 0.75rem;
    font-weight: 500;
    background-color: #dbeafe;
    color: #1e40af;
}

.product-stock {
    display: inline-flex;
    align-items: center;
    font-weight: 500;
}

.product-stock.stock-out {
    color: #dc2626 !important;
}

.product-stock.stock-low {
    color: #d97706 !important;
}

.product-stock.stock-medium {
    color: #2563eb !important;
}

.product-stock.stock-high {
    color: #059669 !important;
}

.product-stock i {
    margin-right: 4px;
}

/* Date hierarchy */
.changelist-date-hierarchy {
    margin-bottom: 16px;
    padding: 16px;
    background: #f9fafb !important;
    border-radius: 8px;
    border: 1px solid #e5e7eb;
}

.changelist-date-hierarchy a {
    color: #2563eb !important;
    text-decoration: none;
    margin: 0 4px;
    font-weight: 500;
}

.changelist-date-hierarchy a:hover {
    color: #1d4ed8 !important;
    text-decoration: underline;
}

/* Responsive design */
@media (max-width: 768px) {
    .changelist-results table {
        font-size: 0.75rem;
    }
    
    .changelist-results thead th,
    .changelist-results tbody td {
        padding: 8px 12px;
    }
}

/* Ensure consistent styling across all admin pages */
.changelist-results table th,
.changelist-results table td {
    text-align: left !important;
}

.changelist-results table th:first-child,
.changelist-results table td:first-child {
    text-align: left !important;
    padding-left: 16px !important;
}

.changelist-results .action-checkbox-column {
    text-align: center !important;
    padding-left: 16px !important;
}

/* Additional consistency fixes */
.changelist-results tbody td:nth-child(2) {
    text-align: left !important;
    font-weight: 500;
}
</style>

<script>
document.addEventListener('DOMContentLoaded', function() {
    // Auto-submit search on Enter
    const searchInput = document.querySelector('input[type="search"]');
    if (searchInput) {
        searchInput.addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                this.form.submit();
            }
        });
    }

    // Smooth scrolling for pagination
    const paginationLinks = document.querySelectorAll('nav a');
    paginationLinks.forEach(link => {
        link.addEventListener('click', function() {
            window.scrollTo({ top: 0, behavior: 'smooth' });
        });
    });

    // Select all functionality
    const selectAllCheckbox = document.querySelector('#action-toggle');
    if (selectAllCheckbox) {
        selectAllCheckbox.addEventListener('change', function() {
            const checkboxes = document.querySelectorAll('input[name="_selected_action"]');
            checkboxes.forEach(checkbox => {
                checkbox.checked = this.checked;
            });
        });
    }

    // Enhanced filter interactions
    const filterOptions = document.querySelectorAll('.filter-option a');
    filterOptions.forEach(option => {
        option.addEventListener('mouseenter', function() {
            if (!this.classList.contains('bg-blue-100')) {
                this.style.transform = 'translateX(4px)';
            }
        });
        
        option.addEventListener('mouseleave', function() {
            this.style.transform = 'translateX(0)';
        });
    });
});
</script>
{% endblock %}